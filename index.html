<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ë¬´ë£Œ ë„ë©”ì¸ ì„œë¹„ìŠ¤</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif; background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); min-height: 100vh; padding: 20px; }
        .container { max-width: 800px; margin: 0 auto; background: white; border-radius: 20px; padding: 40px; box-shadow: 0 20px 60px rgba(0,0,0,0.3); }
        h1 { color: #333; margin-bottom: 30px; text-align: center; }
        .auth-section, .domain-section, .admin-section { display: none; }
        .show { display: block; }
        input, select, button { width: 100%; padding: 12px; margin: 10px 0; border: 2px solid #ddd; border-radius: 8px; font-size: 16px; }
        button { background: #667eea; color: white; border: none; cursor: pointer; font-weight: bold; transition: 0.3s; }
        button:hover { background: #5568d3; }
        .logout { background: #dc3545; margin-top: 20px; }
        .domain-list { margin-top: 30px; }
        .domain-item { background: #f8f9fa; padding: 15px; margin: 10px 0; border-radius: 8px; border-left: 4px solid #667eea; }
        .admin-panel { background: #fff3cd; padding: 20px; border-radius: 8px; margin: 20px 0; }
        .tld-item { background: #e7f3ff; padding: 10px; margin: 10px 0; border-radius: 5px; }
        .user-item { background: #ffe7e7; padding: 10px; margin: 10px 0; border-radius: 5px; display: flex; justify-content: space-between; align-items: center; }
        .btn-small { width: auto; padding: 5px 15px; font-size: 14px; margin: 0 5px; }
        .error { color: #dc3545; margin: 10px 0; }
        .success { color: #28a745; margin: 10px 0; }
        .ns-inputs { display: grid; grid-template-columns: 1fr 1fr; gap: 10px; }
        .tab-buttons { display: flex; gap: 10px; margin: 20px 0; }
        .tab-btn { flex: 1; background: #6c757d; }
        .tab-btn.active { background: #667eea; }
    </style>
</head>
<body>
    <div class="container">
        <h1>ğŸŒ ë¬´ë£Œ ë„ë©”ì¸ ì„œë¹„ìŠ¤</h1>
        
        <div class="auth-section show" id="authSection">
            <h2>ë¡œê·¸ì¸ / íšŒì›ê°€ì…</h2>
            <input type="text" id="authUsername" placeholder="ì‚¬ìš©ìëª…">
            <input type="password" id="authPassword" placeholder="ë¹„ë°€ë²ˆí˜¸">
            <button onclick="login()">ë¡œê·¸ì¸</button>
            <button onclick="register()" style="background: #28a745;">íšŒì›ê°€ì…</button>
            <div id="authMessage"></div>
        </div>

        <div class="domain-section" id="domainSection">
            <h2>ë„ë©”ì¸ ë“±ë¡</h2>
            <input type="text" id="domainName" placeholder="ì›í•˜ëŠ” ë„ë©”ì¸ëª… (ì˜ˆ: mysite)">
            <select id="tldSelect"></select>
            <div class="ns-inputs">
                <input type="text" id="ns1" placeholder="ë„¤ì„ì„œë²„ 1 (í•„ìˆ˜)">
                <input type="text" id="ns2" placeholder="ë„¤ì„ì„œë²„ 2 (ì„ íƒ)">
                <input type="text" id="ns3" placeholder="ë„¤ì„ì„œë²„ 3 (ì„ íƒ)">
                <input type="text" id="ns4" placeholder="ë„¤ì„ì„œë²„ 4 (ì„ íƒ)">
            </div>
            <button onclick="registerDomain()">ë„ë©”ì¸ ë“±ë¡</button>
            <div id="domainMessage"></div>
            
            <div class="domain-list">
                <h3>ë‚´ ë„ë©”ì¸ ëª©ë¡</h3>
                <div id="myDomains"></div>
            </div>
            
            <button class="logout" onclick="logout()">ë¡œê·¸ì•„ì›ƒ</button>
        </div>

        <div class="admin-section" id="adminSection">
            <div class="tab-buttons">
                <button class="tab-btn active" onclick="showTab('tld')">TLD ê´€ë¦¬</button>
                <button class="tab-btn" onclick="showTab('users')">ì‚¬ìš©ì ê´€ë¦¬</button>
                <button class="tab-btn" onclick="showTab('payments')">ê²°ì œ ìŠ¹ì¸</button>
                <button class="tab-btn" onclick="showTab('security')">ë³´ì•ˆ ì„¤ì •</button>
            </div>

            <div id="tldTab" class="admin-panel">
                <h3>TLD ì¶”ê°€</h3>
                <input type="text" id="newTld" placeholder="ìƒˆ TLD (ì˜ˆ: .mysite.com)">
                <input type="number" id="tldPrice" placeholder="ê°€ê²© (0=ë¬´ë£Œ)">
                <input type="text" id="paymentLink" placeholder="ê²°ì œ ë§í¬ (ì„ íƒ)">
                <button onclick="addTld()">TLD ì¶”ê°€</button>
                <div id="tldList"></div>
            </div>

            <div id="usersTab" class="admin-panel" style="display:none;">
                <h3>ì‚¬ìš©ì ê´€ë¦¬</h3>
                <div id="usersList"></div>
            </div>

            <div id="paymentsTab" class="admin-panel" style="display:none;">
                <h3>ê²°ì œ ìŠ¹ì¸ ëŒ€ê¸°</h3>
                <div id="paymentsList"></div>
            </div>

            <div id="securityTab" class="admin-panel" style="display:none;">
                <h3>ë³´ì•ˆë´‡ ì„¤ì •</h3>
                <label>í™œë™ ì‹œì‘ ì‹œê°„ (KST)</label>
                <input type="time" id="botStartTime">
                <label>í™œë™ ì¢…ë£Œ ì‹œê°„ (KST)</label>
                <input type="time" id="botEndTime">
                <button onclick="updateSecurityBot()">ì„¤ì • ì €ì¥</button>
                <div id="securityLogs"></div>
            </div>

            <button class="logout" onclick="logout()">ë¡œê·¸ì•„ì›ƒ</button>
        </div>
    </div>

    <script>
        const API_URL = 'https://your-worker.your-subdomain.workers.dev';
        let currentUser = null;

        async function login() {
            const username = document.getElementById('authUsername').value;
            const password = document.getElementById('authPassword').value;
            const response = await fetch(`${API_URL}/auth/login`, {
                method: 'POST',
                headers: {'Content-Type': 'application/json'},
                body: JSON.stringify({username, password})
            });
            const data = await response.json();
            if(data.success) {
                currentUser = data.user;
                showMessage('authMessage', 'ë¡œê·¸ì¸ ì„±ê³µ!', 'success');
                setTimeout(() => {
                    document.getElementById('authSection').classList.remove('show');
                    if(data.user.isAdmin) {
                        document.getElementById('adminSection').classList.add('show');
                        loadAdminData();
                    } else {
                        document.getElementById('domainSection').classList.add('show');
                        loadUserDomains();
                    }
                    loadTlds();
                }, 500);
            } else {
                showMessage('authMessage', data.message, 'error');
            }
        }

        async function register() {
            const username = document.getElementById('authUsername').value;
            const password = document.getElementById('authPassword').value;
            const response = await fetch(`${API_URL}/auth/register`, {
                method: 'POST',
                headers: {'Content-Type': 'application/json'},
                body: JSON.stringify({username, password})
            });
            const data = await response.json();
            showMessage('authMessage', data.message, data.success ? 'success' : 'error');
        }

        async function registerDomain() {
            const domain = document.getElementById('domainName').value;
            const tld = document.getElementById('tldSelect').value;
            const ns = [1,2,3,4].map(i => document.getElementById(`ns${i}`).value).filter(v => v);
            if(!domain || !tld || ns.length === 0) {
                return showMessage('domainMessage', 'ë„ë©”ì¸ëª…ê³¼ ë„¤ì„ì„œë²„ë¥¼ ì…ë ¥í•˜ì„¸ìš”', 'error');
            }
            const response = await fetch(`${API_URL}/domain/register`, {
                method: 'POST',
                headers: {'Content-Type': 'application/json'},
                body: JSON.stringify({username: currentUser.username, domain, tld, nameservers: ns})
            });
            const data = await response.json();
            showMessage('domainMessage', data.message, data.success ? 'success' : 'error');
            if(data.success) loadUserDomains();
        }

        async function loadTlds() {
            const response = await fetch(`${API_URL}/tlds`);
            const data = await response.json();
            const select = document.getElementById('tldSelect');
            select.innerHTML = data.tlds.map(t => `<option value="${t.name}">${t.name} ${t.price > 0 ? '- â‚©' + t.price : '- ë¬´ë£Œ'}</option>`).join('');
        }

        async function loadUserDomains() {
            const response = await fetch(`${API_URL}/domains/${currentUser.username}`);
            const data = await response.json();
            document.getElementById('myDomains').innerHTML = data.domains.map(d => 
                `<div class="domain-item">
                    <strong>${d.domain}${d.tld}</strong><br>
                    ë„¤ì„ì„œë²„: ${d.nameservers.join(', ')}<br>
                    ë“±ë¡ì¼: ${new Date(d.createdAt).toLocaleDateString()}
                </div>`
            ).join('') || '<p>ë“±ë¡ëœ ë„ë©”ì¸ì´ ì—†ìŠµë‹ˆë‹¤.</p>';
        }

        async function addTld() {
            const name = document.getElementById('newTld').value;
            const price = parseInt(document.getElementById('tldPrice').value) || 0;
            const paymentLink = document.getElementById('paymentLink').value;
            const response = await fetch(`${API_URL}/admin/tld`, {
                method: 'POST',
                headers: {'Content-Type': 'application/json'},
                body: JSON.stringify({name, price, paymentLink, admin: currentUser.username})
            });
            const data = await response.json();
            alert(data.message);
            if(data.success) loadAdminData();
        }

        async function loadAdminData() {
            const tlds = await fetch(`${API_URL}/tlds`).then(r => r.json());
            document.getElementById('tldList').innerHTML = tlds.tlds.map(t => 
                `<div class="tld-item">${t.name} - ${t.price > 0 ? 'â‚©' + t.price : 'ë¬´ë£Œ'} 
                <button class="btn-small" onclick="deleteTld('${t.name}')">ì‚­ì œ</button></div>`
            ).join('');

            const users = await fetch(`${API_URL}/admin/users?admin=${currentUser.username}`).then(r => r.json());
            document.getElementById('usersList').innerHTML = users.users.map(u => 
                `<div class="user-item">${u.username} ${u.status === 'suspended' ? '(ì •ì§€ë¨)' : ''}
                <div>
                    <button class="btn-small" onclick="toggleSuspend('${u.username}')">${u.status === 'suspended' ? 'í•´ì œ' : 'ì •ì§€'}</button>
                    <button class="btn-small" onclick="blacklist('${u.username}')" style="background:#dc3545;">ë¸”ë™ë¦¬ìŠ¤íŠ¸</button>
                </div></div>`
            ).join('');

            const payments = await fetch(`${API_URL}/admin/payments?admin=${currentUser.username}`).then(r => r.json());
            document.getElementById('paymentsList').innerHTML = payments.payments.map(p => 
                `<div class="user-item">${p.username} - ${p.domain}${p.tld}
                <div>
                    <button class="btn-small" onclick="approvePayment('${p.id}')" style="background:#28a745;">ìŠ¹ì¸</button>
                    <button class="btn-small" onclick="rejectPayment('${p.id}')" style="background:#dc3545;">ê±°ë¶€</button>
                </div></div>`
            ).join('') || '<p>ëŒ€ê¸° ì¤‘ì¸ ê²°ì œê°€ ì—†ìŠµë‹ˆë‹¤.</p>';
        }

        async function deleteTld(name) {
            if(!confirm(`${name} TLDë¥¼ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?`)) return;
            await fetch(`${API_URL}/admin/tld/${encodeURIComponent(name)}?admin=${currentUser.username}`, {method: 'DELETE'});
            loadAdminData();
        }

        async function toggleSuspend(username) {
            await fetch(`${API_URL}/admin/user/${username}/suspend?admin=${currentUser.username}`, {method: 'POST'});
            loadAdminData();
        }

        async function blacklist(username) {
            if(!confirm(`${username}ì„ ë¸”ë™ë¦¬ìŠ¤íŠ¸ì— ë“±ì¬í•˜ì‹œê² ìŠµë‹ˆê¹Œ?`)) return;
            await fetch(`${API_URL}/admin/user/${username}/blacklist?admin=${currentUser.username}`, {method: 'POST'});
            loadAdminData();
        }

        async function approvePayment(id) {
            await fetch(`${API_URL}/admin/payment/${id}/approve?admin=${currentUser.username}`, {method: 'POST'});
            loadAdminData();
        }

        async function rejectPayment(id) {
            await fetch(`${API_URL}/admin/payment/${id}/reject?admin=${currentUser.username}`, {method: 'POST'});
            loadAdminData();
        }

        async function updateSecurityBot() {
            const start = document.getElementById('botStartTime').value;
            const end = document.getElementById('botEndTime').value;
            await fetch(`${API_URL}/admin/security`, {
                method: 'POST',
                headers: {'Content-Type': 'application/json'},
                body: JSON.stringify({admin: currentUser.username, startTime: start, endTime: end})
            });
            alert('ë³´ì•ˆë´‡ ì„¤ì •ì´ ì €ì¥ë˜ì—ˆìŠµë‹ˆë‹¤.');
        }

        function showTab(tab) {
            ['tld', 'users', 'payments', 'security'].forEach(t => {
                document.getElementById(`${t}Tab`).style.display = t === tab ? 'block' : 'none';
            });
            document.querySelectorAll('.tab-btn').forEach((btn, i) => {
                btn.classList.toggle('active', ['tld', 'users', 'payments', 'security'][i] === tab);
            });
        }

        function logout() {
            currentUser = null;
            document.getElementById('adminSection').classList.remove('show');
            document.getElementById('domainSection').classList.remove('show');
            document.getElementById('authSection').classList.add('show');
        }

        function showMessage(id, msg, type) {
            const el = document.getElementById(id);
            el.textContent = msg;
            el.className = type;
        }
    </script>
</body>
</html>
